namespace = EMP

# Landless title heir fix
character_event = {
    id = EMP.10010
    hide_window = yes

    is_triggered_only = yes # on_death

    trigger = {
		is_lowborn = no
		# I'm not sure whether the bug is caused by title flags only or with succ_open_elective
		# So the condition here may yet comprehensive
		any_demesne_title = {
			OR = {
				is_primary_type_title = yes
				holy_order = yes
			}
			has_law = succ_open_elective
			NOT = {
				current_heir = { always = yes }
			}
		}
    }

	immediate = {
		any_demesne_title = {
			limit = {
				OR = {
					is_primary_type_title = yes
					holy_order = yes
				}
				has_law = succ_open_elective
				NOT = {
					current_heir = { always = yes }
				}
			}

			create_character = {
				dynasty = none
				random_traits = yes
				female = no
			}
			new_character = {
				create_title = {
					tier = DUKE
					landless = yes
					temporary = yes
					culture = ROOT
					name = TEMPORARY_TITLE
					holder = THIS
				}
				new_title = {
					copy_title_history = PREVPREV
					save_event_target_as = temp_title_history_holder
				}
			}
			save_persistent_event_target = {
				name = title_history_holder
				scope = event_target:temp_title_history_holder
			}
		}
	}
}

# Skip a character for a title
character_event = {
    id = EMP.10011
    hide_window = yes

    is_triggered_only = yes # on_new_holder_inheritance

    trigger = {
		FROM = {
			persistent_event_target:title_history_holder = {
				always = yes
			}
		}
    }

	immediate = {
		FROM = {
			persistent_event_target:title_history_holder = {
				save_event_target_as = temp_title_history_holder
				ROOT_FROM = {
					copy_title_history = event_target:temp_title_history_holder
				}
			}
			clear_persistent_event_target = title_history_holder
		}
		#if = {
		#	limit = {
		#		dynasty = FROMFROM
		#		NOT = {
		#			mother_even_if_dead = {
		#				always = yes
		#			}
		#			father_even_if_dead = {
		#				always = yes
		#			}
		#		}
		#	}

			dynasty = none
			abdicate = yes
			death = { death_reason = death_missing }
		#}
	}

	after = {
		event_target:temp_title_history_holder = {
			holder_scope = {
				death = { death_reason = death_missing }
			}
		}
	}
}