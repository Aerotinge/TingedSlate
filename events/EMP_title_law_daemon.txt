namespace = EMP

# TO cleanup
character_event = {
	id = EMP.20010

	hide_window = yes

	is_triggered_only = yes # on_new_holder(_inheritance/usurpation)

	trigger = {
		FROM = {
			OR = {
				has_law = tribal_organization_0
				has_law = tribal_organization_1
				has_law = tribal_organization_2
				has_law = tribal_organization_3
				has_law = tribal_organization_4
			}
		}
		is_tribal = no
	}

	immediate = {
		FROM = {
			revoke_tribal_organization_effect = yes
		}
	}
}

character_event = {
	id = EMP.20110

	hide_window = yes

	is_triggered_only = yes # on_death

	trigger = {
		any_demesne_title = {
			has_law = succ_open_elective
			OR = {
				has_law = enatic_cognatic_succession
				has_law = enatic_succession
			}
			NOT = {
				current_heir = {
					always = yes
				}
			}
		}
	}

	immediate = {
		any_demesne_title = {
			limit = {
				has_law = succ_open_elective
				OR = {
					has_law = enatic_cognatic_succession
					has_law = enatic_succession
				}
				NOT = {
					current_heir = {
						always = yes
					}
				}
			}

			if = {
				limit = {
					OR = {
						mercenary = yes
						holy_order = yes
					}
				}

				create_random_soldier = {
					random_traits = yes
					female = yes
					dynasty = none
				}
			}
			else = {
				create_character = {
					random_traits = yes
					female = yes
					dynasty = none
				}
			}
		}
		recalc_succession = yes
	}
}

character_event = {
	id = EMP.20120

	hide_window = yes

	is_triggered_only = yes # on_new_holder_inheritance

	trigger = {
		is_priest = yes
		religion_head = {
			OR = {
				has_landed_title = k_papacy
				has_landed_title = d_fraticelli
			}
			current_heir = {
				character = FROMFROM
			}
		}
	}

	immediate = {
		#log = "[This.GetBestName] fires EMP.20120"
		#FROMFROM = { log = "FROMFROM: [This.GetBestName]" }
		# FROMFROM is probably going to be new Pope
		# Give ROOT an one day dummy opnion as a token so FROMFROM can resolve later.
		add_character_modifier = {
			name = pope_ex_see_successor
			days = 1
		}
	}
}

character_event = {
	id = EMP.20121

	hide_window = yes

	is_triggered_only = yes # on_new_holder_inheritance

	trigger = {
		controls_religion = yes
		FROM = {
			OR = {
				title = k_papacy
				title = d_fraticelli
			}
		}
		any_claim = {
			holder_scope = {
				has_character_modifier = pope_ex_see_successor
			}
		}
	}

	immediate = {
		any_claim = {
			limit = {
				holder_scope = {
					has_character_modifier = pope_ex_see_successor
				}
			}
			#log = "Claim - [This.GetFullName] is going to be removed"
			ROOT = { remove_claim = PREV }
		}
		# event_target:ex_see_successor = { remove_character_modifier = pope_ex_see_successor } # Just leave it fade by time
	}
}